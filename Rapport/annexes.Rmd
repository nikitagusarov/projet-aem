
## E Analyse des résultats pour information clusterisée OLS, 2SLS et 3SLS

Etudions la validité du modèle 3SLS : 

```{r include = FALSE}
resdata3x = dataWZ %>% 
    mutate(u1 = sls2x$eq[[1]]$res,
        u2 = sls2x$eq[[2]]$res,
        u3 = sls3x$eq[[1]]$res,
        u4 = sls3x$eq[[2]]$res,
        u5 = fimlx$eq[[1]]$res,
        u6 = fimlx$eq[[2]]$res)
```

\FloatBarrier

```{r include = FALSE}
# h1 = hausman.systemfit(sls2x, sls3x) # p = 1, 3SLS inconsistent
# # 2SLS estimator is consistent
# res = data.frame(Test = c("2SLS contre 3SLS"),
#     Resultats = c(h1$p.val)) 
```

\FloatBarrier

```{r echo = FALSE, results = "asis"}
# stargazer(res, 
#     title = "Hausman 3SLS consistency test",
#     summary = F, 
#     header = F)
```

La normalité des résidus :

```{r include = FALSE}
ShapT = data.frame(nrow = 2, ncol = 6)
ShapT[1,1] = shapiro.test(sls2x$eq[[1]]$res)$p.val
ShapT[2,1] = shapiro.test(sls2x$eq[[2]]$res)$p.val
ShapT[1,2] = shapiro.test(sls3x$eq[[1]]$res)$p.val
ShapT[2,2] = shapiro.test(sls3x$eq[[2]]$res)$p.val
ShapT[1,3] = shapiro.test(fimlx$eq[[1]]$res)$p.val
ShapT[2,3] = shapiro.test(fimlx$eq[[2]]$res)$p.val
colnames(ShapT) = c("2SLS", "3SLS", "i3SLS")
rownames(ShapT) = c("Equation de demande", "Equation d'offre")
```
\FloatBarrier

```{r echo = FALSE, results = "asis"}
stargazer(ShapT,
    summary = FALSE,
    title = "Shapiro-Wilk normality test",
    header = F)
```

\FloatBarrier

L'heteroscedacité :

\FloatBarrier

```{r include = FALSE}
BartT = data.frame(ncol = 3, nrow = 2)
BartT[1,1] = ols_test_bartlett(resdata3x, u1, 
    group_var = ndep)$pval
BartT[2,1] = ols_test_bartlett(resdata3x, u2, 
    group_var = ndep)$pval
BartT[1,2] = ols_test_bartlett(resdata3x, u3, 
    group_var = ndep)$pval
BartT[2,2] = ols_test_bartlett(resdata3x, u4, 
    group_var = ndep)$pval
BartT[1,3] = ols_test_bartlett(resdata3x, u5, 
    group_var = ndep)$pval
BartT[2,3] = ols_test_bartlett(resdata3x, u6, 
    group_var = ndep)$pval
colnames(BartT) = c("2SLS", "3SLS", "i3SLS")
rownames(BartT) = c("Equation de demande", "Equation d'offre")
```
\FloatBarrier

```{r echo = FALSE, results = "asis"}
stargazer(BartT,
    summary = FALSE,
    title = "Bartlett heteroscedasticity test",
    header = F)
```

\FloatBarrier

Les PDF des résidus :

\FloatBarrier

```{r echo = FALSE}
par(mfrow = c(1,2), cex = 0.5)
plot(density(sls2x$eq[[1]]$res), col = "blue", 
    main = "Demande", xlab = "Residuals")
lines(density(sls3x$eq[[1]]$res), col = "green4")
lines(density(fimlx$eq[[1]]$res), col = "red")
plot(density(sls2x$eq[[2]]$res), col = "blue", 
    main = "Offre", xlab = "Residuals")
lines(density(sls3x$eq[[2]]$res), col = "green4")
lines(density(fimlx$eq[[2]]$res), col = "red")
legend(x = "topright", legend = c("2SLS", "3SLS", "i3SLS"),
    col = c("blue", "green4", "red"), xpd = NA,
    cex = 1, lwd = 3)
```

\FloatBarrier

Les résidus contre les variables prédites : 

\FloatBarrier

```{r echo = FALSE}
par(mfrow = c(1,2), cex = 0.5)
plot(y = fimlx$eq[[1]]$res, x = fimlx$eq[[1]]$fit,
    col = "red", 
    main = "Demande", 
    ylab = "Residuals", xlab = "Fitted")
points(y = sls3x$eq[[1]]$res, x = sls3x$eq[[1]]$fit,
    col = "green4", pch = 17)
points(y = sls2x$eq[[1]]$res, x = sls2x$eq[[1]]$fit,
    col = "blue", pch = 14)
plot(y = fimlx$eq[[2]]$res, x = fimlx$eq[[2]]$fit,
    col = "red", 
    main = "Offre", 
    ylab = "Residuals", xlab = "Fitted")
points(y = sls3x$eq[[2]]$res, x = sls3x$eq[[2]]$fit,
    col = "green4", pch = 17)
points(y = sls2x$eq[[2]]$res, x = sls2x$eq[[2]]$fit,
    col = "blue", pch = 14)
par(xpd = NA)
legend(x = "topright", legend = c("2SLS", "3SLS", "i3SLS"),
    col = c("blue", "green4", "red"), xpd = NA,
    cex = 1, lwd = 3)
```

\FloatBarrier

\newpage

## F Dictionnaire des variables 

Finalement, nous offrons au lecteur un tableau de reference pour notre base des données finale.

\FloatBarrier

\begin{table}[!htbp]
  \centering
\caption{Ditionnaire des varibales}
\begin{tabular}{c|l}
  \noindent\rule[0.5ex]{\linewidth}{1pt}
  Variable & Description \\
  \noindent\rule[0.5ex]{\linewidth}{1pt}
année & année \\
ndep & numéro de département \\
si & superficie de vigne sans indication géographique en hectare en log \\
qi & quantité de vins produits en hectolitre en log \\
ipi & indice des prix du vin sans IG déflatés en log  \\
ri & revenu disponible brut des ménages français déflatés en log \\
iki & indice de quantité de pesticides achetés en log \\
t & la tendance temporelle \\
\noindent\rule[0.5ex]{\linewidth}{1pt}
\end{tabular}
\end{table}

\FloatBarrier

\newpage